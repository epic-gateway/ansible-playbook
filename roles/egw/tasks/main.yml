---
# tasks file for egw

- include_tasks: osprepk8s.yml
- include_tasks: postgresql-install.yml
- include_tasks: docker-install.yml
- include_tasks: kube-clients-install.yml
- include_tasks: k8s-install.yml
- include_tasks: multus-install.yml
- include_tasks: router-install.yml
- include_tasks: envoy4egw-install.yml
- include_tasks: web-service-install.yml
- include_tasks: pfc.yml

- name: Fetch the EGW admin kubeconfig # so we can use kubectl from the host
  fetch:
    src: /etc/kubernetes/admin.conf
    dest: egw-admin.conf
    flat: yes
  become: yes

- include_tasks: multus-install.yml
- include_tasks: router-install.yml

- name:  Create acnodal namespace
  command: kubectl create namespace acnodal
  register: result
  failed_when: result.rc != 0 and "AlreadyExists" not in result.stderr

- include_tasks: egw-data-model.yml
- include_tasks: xds-operator.yml
- include_tasks: web-service-install.yml

# FIXME: remove this when we start managing envoy pods dynamically
- include_tasks: envoy4egw-install.yml
